import { onAuthStateChanged } from "firebase/auth";
import { FC, useEffect } from "react";
import styled, { keyframes } from "styled-components";
import { auth } from "../../firebase";
import { sendRenderer } from "../../utils/sendRendererUtils";
import { useAppContext } from "../../context/AppContext";

const pulse = keyframes`
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.7; }
  100% { transform: scale(1); opacity: 1; }
`;

const Wrapper = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-color: var(--bg-color);
  height: 100vh;
  width: 100%;
  color: var(--paragraph);
  gap: 16px;
  margin-top: 0.6em;
  user-select: none;
`;
const Logo = styled.div`
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;

  svg {
    width: 100%;
    height: 100%;
    fill: white;
    animation: ${pulse} 1.8s ease-in-out infinite;
    user-select: none;
  }
`;
const LoadingText = styled.p`
  font-size: 14px;
  color: var(--title);
  letter-spacing: 1px;
  user-select: none;
`;

const UserLoading: FC = () => {

  const {t} = useAppContext();

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (user) => {
      if (user) {
        sendRenderer["login-success"](user.uid);
      } else {
        sendRenderer['logout']();
      }
    });

    return () => unsubscribe();
  }, [])

  return (
    <Wrapper>
      <Logo>
        <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="1275.000000pt" height="1207.000000pt" viewBox="0 0 1275.000000 1207.000000" preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,1207.000000) scale(0.100000,-0.100000)" fill="#FFFFFF" stroke="none">
            <path d="M4116 12060 c-190 -12 -262 -25 -397 -70 -286 -95 -580 -288 -765 -500 -142 -164 -561 -852 -1354 -2225 -216 -374 -570 -984 -785 -1355 -496 -854 -510 -878 -621 -1098 -153 -301 -188 -442 -188 -767 0 -382 47 -529 334 -1060 145 -268 402 -717 662 -1155 368 -621 662 -1120 838 -1420 312 -531 857 -1446 900 -1511 133 -198 351 -429 534 -566 114 -85 314 -195 425 -232 289 -98 631 -108 3261 -94 l1945 11 165 78 c357 169 489 261 665 466 274 317 556 762 1477 2323 923 1566 1385 2389 1471 2625 44 122 67 322 67 595 0 257 -30 417 -115 620 -68 163 -148 304 -561 987 -405 671 -872 1451 -1029 1723 -218 376 -887 1489 -993 1650 -238 364 -424 570 -656 725 -43 29 -171 98 -285 153 l-206 101 -2325 2 c-1279 1 -2387 -2 -2464 -6z m3814 -1410 c397 -13 491 -23 595 -58 101 -35 213 -103 279 -169 164 -165 689 -981 1151 -1788 199 -348 312 -533 515 -845 264 -404 448 -723 619 -1070 172 -348 221 -496 221 -662 0 -260 -109 -503 -572 -1283 -919 -1547 -1021 -1712 -1149 -1849 -42 -45 -135 -125 -213 -183 l-139 -103 -81 0 c-45 0 -409 -9 -810 -20 -566 -15 -732 -22 -741 -32 -7 -7 -108 -173 -225 -368 -329 -549 -409 -664 -506 -729 -64 -42 -177 -76 -298 -91 -337 -40 -1494 -25 -1916 26 -397 47 -645 148 -807 328 -89 100 -430 633 -525 821 -25 50 -132 234 -238 410 -329 547 -1020 1713 -1329 2243 -282 485 -309 565 -298 876 12 318 98 513 529 1193 267 423 385 617 746 1233 954 1627 1160 1928 1406 2048 130 64 206 72 726 82 535 10 2654 3 3060 -10z" />
            <path d="M5615 9740 c-693 -10 -796 -21 -920 -95 -133 -80 -219 -201 -250 -353 -21 -98 -20 -273 0 -353 36 -145 165 -370 625 -1094 382 -602 842 -1349 1010 -1640 79 -138 186 -361 214 -447 14 -42 29 -118 35 -169 14 -126 -3 -430 -29 -536 -27 -105 -145 -343 -380 -763 -106 -190 -220 -393 -252 -452 l-60 -108 -292 0 -293 0 -209 333 c-413 658 -542 887 -551 984 -4 34 -1 52 9 60 28 23 343 43 926 59 193 5 252 10 252 19 0 34 -79 233 -142 359 -154 308 -346 631 -893 1506 -253 406 -361 583 -610 1002 -55 92 -103 167 -107 165 -16 -5 -182 -207 -236 -287 -32 -47 -84 -131 -114 -186 -67 -121 -220 -362 -408 -644 -228 -342 -338 -543 -384 -702 -46 -161 -60 -435 -30 -609 36 -208 99 -336 390 -789 65 -102 288 -466 495 -810 206 -344 441 -733 521 -865 80 -132 175 -294 211 -360 98 -179 110 -197 230 -321 278 -289 472 -369 947 -389 177 -7 594 9 754 30 192 25 237 49 365 199 172 201 344 454 499 733 86 154 154 251 195 278 38 25 161 35 537 45 195 5 371 12 390 15 19 2 73 9 120 15 281 37 460 134 539 294 77 157 91 350 35 516 -15 47 -69 166 -119 265 -160 317 -427 747 -1314 2115 -614 948 -709 1101 -803 1288 -59 117 -73 154 -76 201 -6 85 9 97 129 106 52 4 594 5 1204 3 891 -2 1114 0 1133 10 15 9 22 22 22 42 0 60 -135 291 -428 735 -262 396 -403 504 -732 559 -52 8 -153 20 -225 26 -172 14 -1291 20 -1930 10z" />
            <path d="M8324 7360 c-94 -8 -154 -18 -154 -26 0 -19 230 -433 430 -774 650 -1110 775 -1315 869 -1428 103 -123 195 -153 279 -92 85 61 259 316 422 618 157 291 176 358 186 653 8 223 -6 406 -36 493 -62 182 -244 372 -455 476 -116 57 -156 65 -405 80 -198 11 -997 11 -1136 0z" />
          </g>
        </svg>
      </Logo>
      <LoadingText>{t("user-loading.loading-text")}</LoadingText>
    </Wrapper>
  )
}

export default UserLoading;